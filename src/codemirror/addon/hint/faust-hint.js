import CodeMirror from "codemirror";

var pseudoClasses = {
    link: 1, visited: 1, active: 1, hover: 1, focus: 1,
    "first-letter": 1, "first-line": 1, "first-child": 1,
    before: 1, after: 1, lang: 1
};

// TODO: Is this redundant with modified anyword helper?
CodeMirror.registerHelper("hint", "faust2", function (cm) {
    var cur = cm.getCursor(),
        token = cm.getTokenAt(cur);
    var inner = CodeMirror.innerMode(cm.getMode(), token.state);
    if (inner.mode.name != "faust") return;

    if (token.type == "keyword" && "!important".indexOf(token.string) == 0)
        return {
            list: ["!important"], from: CodeMirror.Pos(cur.line, token.start),
            to: CodeMirror.Pos(cur.line, token.end)
        };

    var start = token.start, end = cur.ch, word = token.string.slice(0, end - start);
    if (/[^\w$_-]/.test(word)) {
        word = ""; start = end = cur.ch;
    }

    var atoms =
        "mem prefix int float rdtable rwtable select2 select3 ffunction fconstant fvariable button checkbox vslider hslider nentry vgroup hgroup tgroup vbargraph hbargraph attach acos asin atan atan2 cos sin tan exp log log10 pow sqrt abs min max fmod remainder floor ceil rint"
            .split(" ");

    var result = [];
    function add(keywords) {
        for (var name in keywords)
            if (!word || name.lastIndexOf(word, 0) == 0)
                result.push(name);
    }

    add(atoms);

    if (result.length) return {
        list: result,
        from: CodeMirror.Pos(cur.line, start),
        to: CodeMirror.Pos(cur.line, end)
    };
});
